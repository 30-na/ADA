<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="sina mokhtar">
<meta name="dcterms.date" content="2023-03-09">
<meta name="description" content="[Advanced Data Analysis 2](https://StatAcumen.com/teach/ada12, Stat 428/528, Spring 2023, Prof.&nbsp;Erik Erhardt, UNM">

<title>ADA2: Class 14, Ch 07b, Analysis of Covariance</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="ADA2_CL_14_ANCOVA_AbqHomePrices_files/libs/quarto-html/quarto.js"></script>
<script src="ADA2_CL_14_ANCOVA_AbqHomePrices_files/libs/quarto-html/popper.min.js"></script>
<script src="ADA2_CL_14_ANCOVA_AbqHomePrices_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="ADA2_CL_14_ANCOVA_AbqHomePrices_files/libs/quarto-html/anchor.min.js"></script>
<link href="ADA2_CL_14_ANCOVA_AbqHomePrices_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="ADA2_CL_14_ANCOVA_AbqHomePrices_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="ADA2_CL_14_ANCOVA_AbqHomePrices_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="ADA2_CL_14_ANCOVA_AbqHomePrices_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="ADA2_CL_14_ANCOVA_AbqHomePrices_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-full">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
</div>
<main class="content column-page" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">ADA2: Class 14, Ch 07b, Analysis of Covariance</h1>
</div>

<div>
  <div class="description">
    <p>[Advanced Data Analysis 2](https://StatAcumen.com/teach/ada12, Stat 428/528, Spring 2023, Prof.&nbsp;Erik Erhardt, UNM</p>
  </div>
</div>


<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>sina mokhtar </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">March 9, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header>
<nav id="TOC" role="doc-toc">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#ancova-model-albuquerque-nm-87108-house-and-apartment-listing-prices" id="toc-ancova-model-albuquerque-nm-87108-house-and-apartment-listing-prices">ANCOVA model: Albuquerque NM 87108, House and Apartment listing prices</a>
  <ul>
  <li><a href="#unusual-assignment-not-top-down-but-up-down-up-down" id="toc-unusual-assignment-not-top-down-but-up-down-up-down">Unusual assignment, not top-down, but up-down-up-down</a>
  <ul>
  <li><a href="#keep-a-record-of-your-decisions" id="toc-keep-a-record-of-your-decisions">Keep a record of your decisions</a></li>
  </ul></li>
  <li><a href="#p-step-1-restrict-data-to-typical-dwellings" id="toc-p-step-1-restrict-data-to-typical-dwellings"><strong>(2 p)</strong> (Step 1) Restrict data to “typical” dwellings</a></li>
  <li><a href="#p-step-3-transform-response-if-necessary." id="toc-p-step-3-transform-response-if-necessary."><strong>(2 p)</strong> (Step 3) Transform response, if necessary.</a>
  <ul>
  <li><a href="#solution" id="toc-solution">Solution</a></li>
  </ul></li>
  <li><a href="#p-step-4-remove-extremely-influential-observations." id="toc-p-step-4-remove-extremely-influential-observations."><strong>(2 p)</strong> (Step 4) Remove extremely influential observations.</a></li>
  <li><a href="#subset-data-for-model-building-and-prediction" id="toc-subset-data-for-model-building-and-prediction">Subset data for model building and prediction</a>
  <ul>
  <li><a href="#solution-1" id="toc-solution-1">Solution</a></li>
  </ul></li>
  <li><a href="#p-step-2-fit-full-two-way-interaction-model." id="toc-p-step-2-fit-full-two-way-interaction-model."><strong>(2 p)</strong> (Step 2) Fit full two-way interaction model.</a>
  <ul>
  <li><a href="#solution-2" id="toc-solution-2">Solution</a></li>
  </ul></li>
  <li><a href="#p-step-5-model-selection-check-model-assumptions." id="toc-p-step-5-model-selection-check-model-assumptions."><strong>(2 p)</strong> (Step 5) Model selection, check model assumptions.</a>
  <ul>
  <li><a href="#solution-3" id="toc-solution-3">Solution</a></li>
  </ul></li>
  <li><a href="#p-step-6-plot-final-model-interpret-coefficients." id="toc-p-step-6-plot-final-model-interpret-coefficients."><strong>(4 p)</strong> (Step 6) Plot final model, interpret coefficients.</a>
  <ul>
  <li><a href="#solution-4" id="toc-solution-4">Solution</a></li>
  </ul></li>
  <li><a href="#p-step-7-transform-predictors." id="toc-p-step-7-transform-predictors."><strong>(2 p)</strong> (Step 7) Transform predictors.</a></li>
  <li><a href="#p-step-8-predict-new-observations-interpret-models-predictive-ability." id="toc-p-step-8-predict-new-observations-interpret-models-predictive-ability."><strong>(4 p)</strong> (Step 8) Predict new observations, interpret model’s predictive ability.</a>
  <ul>
  <li><a href="#solution-5" id="toc-solution-5">Solution</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
<p>This is a challenging dataset, in part because it’s real and messy. I will guide you through a simplified sensible analysis, but other models are possible.</p>
<p><em>Note that I needed to set <code>cache=FALSE</code> to assure all output was updated.</em></p>
<section id="ancova-model-albuquerque-nm-87108-house-and-apartment-listing-prices" class="level1">
<h1>ANCOVA model: Albuquerque NM 87108, House and Apartment listing prices</h1>
<p>Prof Erhardt constructed a dataset of listing prices for dwellings (homes and apartments) for sale from <a href="http://www.zillow.com/homes/for_sale/Albuquerque-NM-87108/95303_rid/any_days/35.095087-106.52167835.035021-106.633258_rect/13_zm/0_mmm/">Zillow.com</a> on Feb 26, 2016 at 1 PM for Albuquerque NM 87108. In this assignment we’ll develop a model to help understand which qualities that contribute to a <strong>typical dwelling’s listing price</strong>. We will then also predict the listing prices of new listings posted on the following day, Feb 27, 2016 by 2 PM.</p>
<p>Because we want to model a <em>typical dwelling</em>, it is completely reasonable to remove “unusual” dwellings from the dataset. Dwellings have a distribution with a <a href="https://en.wikipedia.org/wiki/Long_tail">long tail</a>!</p>
<section id="unusual-assignment-not-top-down-but-up-down-up-down" class="level2">
<h2 class="anchored" data-anchor-id="unusual-assignment-not-top-down-but-up-down-up-down">Unusual assignment, not top-down, but up-down-up-down</h2>
<p>This is an unusual assignment because the workflow of this assignment isn’t top-down; instead, you’ll be scrolling up and down as you make decisions about the data and model you’re fitting. Yes, I have much of the code worked out for you. However, there are data decisions to make early in the code (such as excluding observations, transforming variables, etc.) that depend on the analysis (model checking) later. Think of it as a “choose your own adventure” that I’ve written for you.</p>
<section id="keep-a-record-of-your-decisions" class="level3">
<h3 class="anchored" data-anchor-id="keep-a-record-of-your-decisions">Keep a record of your decisions</h3>
<p>It is always desirable to make your work reproducible, either by someone else or by your future self. For each step you take, keep a diary of (a) what the next minor goal is, (b) what evidence/information you have, (c) what decision you make, and (d) what the outcome was.</p>
<p>For example, here’s the first couple steps of your diary:</p>
<ol type="1">
<li>Include only “typical dwellings”. Based on scatterplot, remove extreme observations. Keep only HOUSE and APARTMENT.</li>
<li>Exclude a few variables to reduce multicollinearity between predictor variables. Exclude <code>Baths</code> and <code>LotSize</code>.</li>
<li>etc.</li>
</ol>
</section>
</section>
<section id="p-step-1-restrict-data-to-typical-dwellings" class="level2">
<h2 class="anchored" data-anchor-id="p-step-1-restrict-data-to-typical-dwellings"><strong>(2 p)</strong> (Step 1) Restrict data to “typical” dwellings</h2>
<p><strong>Step 1:</strong> After looking at the scatterplot below, identify what you consider to be a “typical dwelling” and exclude observations far from that range. For example, there are only a couple <code>TypeSale</code> that are common enough to model; remember to run <code>factor()</code> again to remove factor levels that no longer appear.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(erikmisc)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching packages ─────────────────────────────────────── erikmisc 0.1.18 ──</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>✔ tibble 3.1.8      ✔ dplyr  1.0.10</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Conflicts ─────────────────────────────────────────── erikmisc_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>erikmisc, solving common complex data analysis workflows
  by Dr. Erik Barry Erhardt &lt;erik@StatAcumen.com&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching packages ─────────────────────────────────────── tidyverse 1.3.2
──</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>✔ ggplot2 3.4.1     ✔ purrr   1.0.1
✔ tidyr   1.3.0     ✔ stringr 1.5.0
✔ readr   2.1.3     ✔ forcats 1.0.0
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co"># First, download the data to your computer,</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co">#   save in the same folder as this Rmd file.</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="co"># read the data, skip the first two comment lines of the data file</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>dat_abq <span class="ot">&lt;-</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_csv</span>(<span class="st">"ADA2_CL_14_HomePricesZillow_Abq87108.csv"</span>, <span class="at">skip=</span><span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">id =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>  , <span class="at">TypeSale =</span> <span class="fu">factor</span>(TypeSale)</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># To help scale the intercept to a more reasonable value</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">#   Scaling the x-variables are sometimes done to the mean of each x.</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># center year at 1900 (negative values are older, -10 is built in 1890)</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>  , <span class="at">YearBuilt_1900 =</span> YearBuilt <span class="sc">-</span> <span class="dv">1900</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>    id, <span class="fu">everything</span>()</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>    , <span class="sc">-</span>Address, <span class="sc">-</span>YearBuilt</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 143 Columns: 9
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (2): Address, TypeSale
dbl (7): PriceList, Beds, Baths, Size_sqft, LotSize, YearBuilt, DaysListed

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dat_abq)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 9
     id TypeSale  PriceList  Beds Baths Size_sqft LotSize DaysListed YearBuilt…¹
  &lt;int&gt; &lt;fct&gt;         &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;      &lt;dbl&gt;       &lt;dbl&gt;
1     1 HOUSE        186900     3     2      1305    6969          0          54
2     2 APARTMENT    305000     1     1      2523    6098          0          48
3     3 APARTMENT    244000     1     1      2816    6098          0          89
4     4 CONDO        108000     3     2      1137      NA          0          96
5     5 CONDO         64900     2     1      1000      NA          1          85
6     6 HOUSE        275000     3     3      2022    6098          1          52
# … with abbreviated variable name ¹​YearBuilt_1900</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="do">## RETURN HERE TO SUBSET THE DATA</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>dat_abq <span class="ot">&lt;-</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  dat_abq <span class="sc">%&gt;%</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    TypeSale <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"APARTMENT"</span> , <span class="st">"HOUSE"</span>)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">#, !id %in% c(120, 130, 50)# (X &lt;= z)  # keep observations where variable X &lt;= value z</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">TypeSale =</span> <span class="fu">factor</span>(TypeSale)</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="co"># note, if you remove a level from a categorical variable, then run factor() again</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># SOLUTION</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># these deletions are based only on the scatter plot in order to have</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>  <span class="co">#  "typical" dwellings</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(dat_abq)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       id              TypeSale    PriceList            Beds     
 Min.   :  1.00   APARTMENT:41   Min.   :  65000   Min.   :1.00  
 1st Qu.: 39.75   HOUSE    :91   1st Qu.: 139250   1st Qu.:1.00  
 Median : 72.50                  Median : 169250   Median :3.00  
 Mean   : 73.32                  Mean   : 226403   Mean   :2.28  
 3rd Qu.:108.25                  3rd Qu.: 249250   3rd Qu.:3.00  
 Max.   :143.00                  Max.   :3110000   Max.   :5.00  
                                                                 
     Baths         Size_sqft        LotSize         DaysListed    
 Min.   :1.000   Min.   :  783   Min.   :  3049   Min.   :   0.0  
 1st Qu.:1.000   1st Qu.: 1310   1st Qu.:  6534   1st Qu.:  33.5  
 Median :1.000   Median : 1748   Median :  6969   Median :  88.0  
 Mean   :1.542   Mean   : 2272   Mean   : 13571   Mean   : 122.4  
 3rd Qu.:2.000   3rd Qu.: 2559   3rd Qu.:  8712   3rd Qu.: 174.0  
 Max.   :5.000   Max.   :33000   Max.   :609840   Max.   :1867.0  
 NA's   :1                       NA's   :18                       
 YearBuilt_1900  
 Min.   : 30.00  
 1st Qu.: 50.00  
 Median : 52.00  
 Mean   : 56.72  
 3rd Qu.: 60.00  
 Max.   :106.00  
 NA's   :3       </code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co">#filter(dat_abq, id == 21)</span></span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(GGally)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Registered S3 method overwritten by 'GGally':
  method from   
  +.gg   ggplot2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co">#ggpairs(dat_abq[,c("TypeSale", "PriceList", "Beds", "Baths", "Size_sqft")])</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggpairs</span>(dat_abq <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">everything</span>(), <span class="sc">-</span>id, <span class="sc">-</span>Baths), <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">color=</span>TypeSale, <span class="at">alpha=</span>.<span class="dv">5</span>))</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="ADA2_CL_14_ANCOVA_AbqHomePrices_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="960"></p>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>dat_abq_reduced <span class="ot">=</span> dat_abq <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">everything</span>(), <span class="sc">-</span>Baths, <span class="sc">-</span>LotSize) <span class="sc">%&gt;%</span> <span class="fu">na.omit</span>()</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggpairs</span>(dat_abq_reduced <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">everything</span>(), <span class="sc">-</span>id), <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">color=</span>TypeSale, <span class="at">alpha=</span>.<span class="dv">5</span>))</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="ADA2_CL_14_ANCOVA_AbqHomePrices_files/figure-html/unnamed-chunk-2-2.png" class="img-fluid" width="960"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(dat_abq_reduced <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">everything</span>(), <span class="sc">-</span>id, <span class="sc">-</span>TypeSale))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                PriceList        Beds   Size_sqft  DaysListed YearBuilt_1900
PriceList      1.00000000  0.01050194  0.93729170  0.01589238     0.04649946
Beds           0.01050194  1.00000000 -0.17577972 -0.12561607    -0.21475246
Size_sqft      0.93729170 -0.17577972  1.00000000  0.04687242     0.16943291
DaysListed     0.01589238 -0.12561607  0.04687242  1.00000000     0.07070996
YearBuilt_1900 0.04649946 -0.21475246  0.16943291  0.07070996     1.00000000</code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>dat_abq,</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x=</span>Size_sqft,</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">y=</span>PriceList,</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">color=</span>TypeSale,</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">label=</span>id))<span class="sc">+</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">alpha =</span> .<span class="dv">5</span>,</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">nudge_x =</span> <span class="fl">0.3</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="ADA2_CL_14_ANCOVA_AbqHomePrices_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="576"></p>
</div>
</div>
</section>
<section id="p-step-3-transform-response-if-necessary." class="level2">
<h2 class="anchored" data-anchor-id="p-step-3-transform-response-if-necessary."><strong>(2 p)</strong> (Step 3) Transform response, if necessary.</h2>
<p><strong>Step 3:</strong> Does the response variable require a transformation? If so, what transformation is recommended from the model diagnostic plots (Box-Cox)?</p>
<section id="solution" class="level3">
<h3 class="anchored" data-anchor-id="solution">Solution</h3>
<p>Yes we need transformation based of COX-BOX plot (it contain zero) we do log transformation. [answer]</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: carData</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'car'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:purrr':

    some</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:dplyr':

    recode</code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>full.model.lm <span class="ot">=</span> <span class="fu">lm</span>(</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  PriceList <span class="sc">~</span> (TypeSale <span class="sc">+</span> Beds <span class="sc">+</span> Size_sqft <span class="sc">+</span> DaysListed <span class="sc">+</span> YearBuilt_1900)<span class="sc">^</span><span class="dv">2</span>, </span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dat_abq_reduced)</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(full.model.lm)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = PriceList ~ (TypeSale + Beds + Size_sqft + DaysListed + 
    YearBuilt_1900)^2, data = dat_abq_reduced)

Residuals:
    Min      1Q  Median      3Q     Max 
-187238  -39119     521   33801  392702 

Coefficients: (1 not defined because of singularities)
                               Estimate Std. Error t value Pr(&gt;|t|)  
(Intercept)                   1.932e+04  1.473e+05   0.131   0.8959  
TypeSaleHOUSE                 3.098e+05  1.970e+05   1.573   0.1185  
Beds                         -1.404e+05  8.320e+04  -1.688   0.0942 .
Size_sqft                     1.538e+02  7.229e+01   2.127   0.0356 *
DaysListed                   -3.851e+02  4.083e+02  -0.943   0.3476  
YearBuilt_1900                1.936e+02  2.276e+03   0.085   0.9324  
TypeSaleHOUSE:Beds                   NA         NA      NA       NA  
TypeSaleHOUSE:Size_sqft       1.714e+01  3.703e+01   0.463   0.6443  
TypeSaleHOUSE:DaysListed      3.850e+02  2.529e+02   1.522   0.1307  
TypeSaleHOUSE:YearBuilt_1900 -5.723e+03  3.110e+03  -1.841   0.0683 .
Beds:Size_sqft                2.946e+00  1.036e+01   0.284   0.7766  
Beds:DaysListed              -1.298e+02  1.056e+02  -1.230   0.2214  
Beds:YearBuilt_1900           2.817e+03  1.352e+03   2.084   0.0394 *
Size_sqft:DaysListed          2.118e-01  1.063e-01   1.992   0.0487 *
Size_sqft:YearBuilt_1900     -1.748e+00  9.800e-01  -1.784   0.0771 .
DaysListed:YearBuilt_1900    -5.985e-02  5.324e+00  -0.011   0.9911  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 73770 on 114 degrees of freedom
Multiple R-squared:  0.9367,    Adjusted R-squared:  0.9289 
F-statistic: 120.5 on 14 and 114 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co">#car::Anova(full.model.lm, type=3)</span></span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">e_plot_lm_diagostics</span>(full.model.lm)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="ADA2_CL_14_ANCOVA_AbqHomePrices_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="480"></p>
</div>
<div class="cell-output-display">
<p><img src="ADA2_CL_14_ANCOVA_AbqHomePrices_files/figure-html/unnamed-chunk-5-2.png" class="img-fluid" width="480"></p>
</div>
<div class="cell-output-display">
<p><img src="ADA2_CL_14_ANCOVA_AbqHomePrices_files/figure-html/unnamed-chunk-5-3.png" class="img-fluid" width="480"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Non-constant Variance Score Test 
Variance formula: ~ fitted.values 
Chisquare = 0.1788738, Df = 1, p = 0.67234</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>there are higher-order terms (interactions) in this model
consider setting type = 'predictor'; see ?vif</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error in vif.default(fit): there are aliased coefficients in the model</code></pre>
</div>
<div class="cell-output-display">
<p><img src="ADA2_CL_14_ANCOVA_AbqHomePrices_files/figure-html/unnamed-chunk-5-4.png" class="img-fluid" width="480"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>dat_abq_trans <span class="ot">&lt;-</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  dat_abq_reduced <span class="sc">%&gt;%</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Price in units of $1000</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">PriceListK =</span> (PriceList <span class="sc">/</span> <span class="dv">1000</span>)</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># SOLUTION</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>    <span class="sc">-</span>PriceList</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(dat_abq_trans)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>tibble [129 × 7] (S3: tbl_df/tbl/data.frame)
 $ id            : int [1:129] 1 2 3 6 7 9 10 12 13 14 ...
 $ TypeSale      : Factor w/ 2 levels "APARTMENT","HOUSE": 2 1 1 2 2 2 2 1 2 2 ...
 $ Beds          : num [1:129] 3 1 1 3 2 3 3 1 4 2 ...
 $ Size_sqft     : num [1:129] 1305 2523 2816 2022 1440 ...
 $ DaysListed    : num [1:129] 0 0 0 1 1 1 2 2 6 6 ...
 $ YearBuilt_1900: num [1:129] 54 48 89 52 52 58 52 49 41 53 ...
 $ PriceListK    : num [1:129] 187 305 244 275 133 ...
 - attr(*, "na.action")= 'omit' Named int [1:3] 57 83 98
  ..- attr(*, "names")= chr [1:3] "57" "83" "98"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>full.model.log <span class="ot">=</span> <span class="fu">lm</span>(</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">log10</span>(PriceListK) <span class="sc">~</span> (TypeSale <span class="sc">+</span> Beds <span class="sc">+</span> Size_sqft <span class="sc">+</span> DaysListed <span class="sc">+</span> YearBuilt_1900)<span class="sc">^</span><span class="dv">2</span>, </span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dat_abq_trans)</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">e_plot_lm_diagostics</span>(full.model.log)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="ADA2_CL_14_ANCOVA_AbqHomePrices_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="480"></p>
</div>
<div class="cell-output-display">
<p><img src="ADA2_CL_14_ANCOVA_AbqHomePrices_files/figure-html/unnamed-chunk-7-2.png" class="img-fluid" width="480"></p>
</div>
<div class="cell-output-display">
<p><img src="ADA2_CL_14_ANCOVA_AbqHomePrices_files/figure-html/unnamed-chunk-7-3.png" class="img-fluid" width="480"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Non-constant Variance Score Test 
Variance formula: ~ fitted.values 
Chisquare = 0.3182669, Df = 1, p = 0.57265</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>there are higher-order terms (interactions) in this model
consider setting type = 'predictor'; see ?vif</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error in vif.default(fit): there are aliased coefficients in the model</code></pre>
</div>
<div class="cell-output-display">
<p><img src="ADA2_CL_14_ANCOVA_AbqHomePrices_files/figure-html/unnamed-chunk-7-4.png" class="img-fluid" width="480"></p>
</div>
</div>
</section>
</section>
<section id="p-step-4-remove-extremely-influential-observations." class="level2">
<h2 class="anchored" data-anchor-id="p-step-4-remove-extremely-influential-observations."><strong>(2 p)</strong> (Step 4) Remove extremely influential observations.</h2>
<p><strong>Step 4:</strong> The goal is to develop a model that will work well for the typical dwellings. If an observation is highly influential, then it’s unusual.</p>
<p>based on Cooks dist vs Leverage plot we noticed observations with id 132 are highly influential and also we remove PriceListK &lt; 500, Size_sqft &lt; 4000, Beds &lt; 5, and DaysListed &lt; 300 and YearBuilt_1900 &lt; 100 to develop a model that will work well for the typical dwellings.<br>
After transformation and removing influential observation it seems all assumptions are met</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(dat_abq_trans)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "id"             "TypeSale"       "Beds"           "Size_sqft"     
[5] "DaysListed"     "YearBuilt_1900" "PriceListK"    </code></pre>
</div>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Remove influential observation</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="co">#dat_abq_rem_influen[107,]</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>  dat_abq_rem_influen <span class="ot">&lt;-</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>    dat_abq_trans <span class="sc">%&gt;%</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>     <span class="co"># !(id  %in% c(120, 143, 130, 32, 50, 134, 140)),</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>      <span class="sc">!</span>(id  <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">132</span>)),</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>      PriceListK <span class="sc">&lt;</span> <span class="dv">500</span>,</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>      Size_sqft <span class="sc">&lt;</span> <span class="dv">4000</span>,</span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>      Beds <span class="sc">&lt;</span> <span class="dv">5</span>,</span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>      DaysListed <span class="sc">&lt;</span> <span class="dv">300</span>,</span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>      YearBuilt_1900 <span class="sc">&lt;</span> <span class="dv">100</span></span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># SOLUTION</span></span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a>full.model.log <span class="ot">=</span> <span class="fu">lm</span>(</span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">log10</span>(PriceListK) <span class="sc">~</span> (TypeSale <span class="sc">+</span> Beds <span class="sc">+</span> Size_sqft <span class="sc">+</span> DaysListed <span class="sc">+</span> YearBuilt_1900)<span class="sc">^</span><span class="dv">2</span>, </span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dat_abq_rem_influen)</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">e_plot_lm_diagostics</span>(full.model.log)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="ADA2_CL_14_ANCOVA_AbqHomePrices_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="960"></p>
</div>
<div class="cell-output-display">
<p><img src="ADA2_CL_14_ANCOVA_AbqHomePrices_files/figure-html/unnamed-chunk-9-2.png" class="img-fluid" width="960"></p>
</div>
<div class="cell-output-display">
<p><img src="ADA2_CL_14_ANCOVA_AbqHomePrices_files/figure-html/unnamed-chunk-9-3.png" class="img-fluid" width="960"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Non-constant Variance Score Test 
Variance formula: ~ fitted.values 
Chisquare = 0.4715461, Df = 1, p = 0.49228</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>there are higher-order terms (interactions) in this model
consider setting type = 'predictor'; see ?vif</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error in vif.default(fit): there are aliased coefficients in the model</code></pre>
</div>
<div class="cell-output-display">
<p><img src="ADA2_CL_14_ANCOVA_AbqHomePrices_files/figure-html/unnamed-chunk-9-4.png" class="img-fluid" width="960"></p>
</div>
</div>
</section>
<section id="subset-data-for-model-building-and-prediction" class="level2">
<h2 class="anchored" data-anchor-id="subset-data-for-model-building-and-prediction">Subset data for model building and prediction</h2>
<p>Create a subset of the data for building the model, and another subset for prediction later on.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># remove observations with NAs</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>dat_abq_rem_influen <span class="ot">&lt;-</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>  dat_abq_rem_influen <span class="sc">%&gt;%</span></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na.omit</span>()</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a><span class="co"># the data subset we will use to build our model</span></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>dat_sub <span class="ot">&lt;-</span></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>  dat_abq_rem_influen <span class="sc">%&gt;%</span></span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>    DaysListed <span class="sc">&gt;</span> <span class="dv">0</span></span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a><span class="co"># the data subset we will predict from our model</span></span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a>dat_pred <span class="ot">&lt;-</span></span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a>  dat_abq_rem_influen <span class="sc">%&gt;%</span></span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a>    DaysListed <span class="sc">==</span> <span class="dv">0</span></span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb52-19"><a href="#cb52-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb52-20"><a href="#cb52-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># the prices we hope to predict closely from our model</span></span>
<span id="cb52-21"><a href="#cb52-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">PriceListK_true =</span> PriceListK</span>
<span id="cb52-22"><a href="#cb52-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># set them to NA to predict them later</span></span>
<span id="cb52-23"><a href="#cb52-23" aria-hidden="true" tabindex="-1"></a>  , <span class="at">PriceListK =</span> <span class="cn">NA</span></span>
<span id="cb52-24"><a href="#cb52-24" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
</div>
<p>Scatterplot of the model-building subset.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">NOTE</span><span class="co">, this plot takes a long time if you're repeadly recompiling the document.</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="co"># comment the "print(p)" line so save some time when you're not evaluating this plot.</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(GGally)</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggpairs</span>(</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>    dat_sub</span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>  , <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">colour =</span> TypeSale, <span class="at">alpha =</span> <span class="fl">0.5</span>)</span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>  , <span class="at">lower =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="st">"points"</span>)</span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>  , <span class="at">upper =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="st">"cor"</span>)</span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>  , <span class="at">progress =</span> <span class="cn">FALSE</span></span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in cor(x, y): the standard deviation is zero</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in cor(x, y): the standard deviation is zero

Warning in cor(x, y): the standard deviation is zero

Warning in cor(x, y): the standard deviation is zero

Warning in cor(x, y): the standard deviation is zero</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="ADA2_CL_14_ANCOVA_AbqHomePrices_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="768"></p>
</div>
</div>
<p>There are clearly some unusual observations. Go back to the first code chunk and remove some observations that don’t represent a “typical” dwelling.</p>
<p>For example, remove these dwellings (in code above):</p>
<ul>
<li>Super expensive dwelling</li>
<li>Dwellings with huge lots</li>
<li>Dwellings that were listed for years</li>
<li>Because most dwellings were APARTMENTs and HOUSEs, remove the others (there are only 1 or so of each).</li>
</ul>
<p>Discuss the observed correlations or other outstanding features in the data.</p>
<section id="solution-1" class="level3">
<h3 class="anchored" data-anchor-id="solution-1">Solution</h3>
<p>[answer]</p>
<p>Features of data: 1. “TypeSale”<br>
2. “Beds”<br>
3. “Size_sqft”<br>
4. “DaysListed”<br>
5. “YearBuilt_1900”</p>
<p>There was high correletion between beds and baths and also ypeSale:Beds which cause coliniarity problem in or model. in addition we did transformation and removed influential observations.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(dat_sub)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "id"             "TypeSale"       "Beds"           "Size_sqft"     
[5] "DaysListed"     "YearBuilt_1900" "PriceListK"    </code></pre>
</div>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>dat_sub,</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x=</span>DaysListed,</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">y=</span>PriceListK,</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">color=</span>TypeSale,</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">label=</span>id))<span class="sc">+</span></span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">alpha =</span> .<span class="dv">5</span>,</span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">nudge_x =</span> <span class="fl">0.3</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="ADA2_CL_14_ANCOVA_AbqHomePrices_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="576"></p>
</div>
</div>
</section>
</section>
<section id="p-step-2-fit-full-two-way-interaction-model." class="level2">
<h2 class="anchored" data-anchor-id="p-step-2-fit-full-two-way-interaction-model."><strong>(2 p)</strong> (Step 2) Fit full two-way interaction model.</h2>
<p><em>You’ll revisit this section after each modification of the data above.</em></p>
<p><strong>Step 2:</strong> Let’s fit the full two-way interaction model and assess the assumptions. However, some of the predictor variables are highly correlated. Recall that the interpretation of a beta coefficient is “the expected increase in the response for a 1-unit increase in <span class="math inline">\(x\)</span> with all other predictors held constant”. It’s hard to hold one variable constant if it’s correlated with another variable you’re increasing. Therefore, we’ll make a decision to retain some variables but not others depending on their correlation values. (In the PCA chapter, we’ll see another strategy.)</p>
<p>Somewhat arbitrarily, let’s exclude <code>Baths</code> (since highly correlated with <code>Beds</code> and <code>Size_sqft</code>). Let’s also exclude <code>LotSize</code> (since highly correlated with <code>Size_sqft</code>). Modify the code below. Notice that because APARTMENTs don’t have more than 1 Beds or Baths, those interaction terms need to be excluded from the model; I show you how to do this manually using the <code>update()</code> function.</p>
<p>Note that the formula below <code>y ~ (x1 + x2 + x3)^2</code> expands into all main effects and two-way interactions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>  <span class="do">## SOLUTION</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>  lm_full <span class="ot">&lt;-</span></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lm</span>(</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">log10</span>(PriceListK) <span class="sc">~</span> (TypeSale <span class="sc">+</span> Beds <span class="sc">+</span> Size_sqft <span class="sc">+</span> DaysListed <span class="sc">+</span> YearBuilt_1900)<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>    , <span class="at">data =</span> dat_sub</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">#lm_full &lt;-</span></span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">#  lm(</span></span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">#    PriceListK ~ (Beds + Baths + Size_sqft + LotSize + DaysListed + YearBuilt_1900)^2</span></span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">#  , data = dat_sub</span></span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">#  )</span></span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>(lm_full)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = log10(PriceListK) ~ (TypeSale + Beds + Size_sqft + 
    DaysListed + YearBuilt_1900)^2, data = dat_sub)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.38166 -0.06724  0.01320  0.06718  0.29322 

Coefficients: (1 not defined because of singularities)
                               Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)                   2.347e+00  3.609e-01   6.504 4.15e-09 ***
TypeSaleHOUSE                 3.714e-01  4.415e-01   0.841    0.402    
Beds                         -1.697e-01  1.697e-01  -1.000    0.320    
Size_sqft                     1.350e-04  1.777e-04   0.760    0.449    
DaysListed                   -2.822e-04  1.418e-03  -0.199    0.843    
YearBuilt_1900               -1.017e-02  7.562e-03  -1.345    0.182    
TypeSaleHOUSE:Beds                   NA         NA      NA       NA    
TypeSaleHOUSE:Size_sqft       4.803e-06  1.190e-04   0.040    0.968    
TypeSaleHOUSE:DaysListed      9.868e-04  9.567e-04   1.032    0.305    
TypeSaleHOUSE:YearBuilt_1900 -5.155e-03  7.955e-03  -0.648    0.519    
Beds:Size_sqft                1.177e-05  4.637e-05   0.254    0.800    
Beds:DaysListed              -4.293e-04  4.047e-04  -1.061    0.292    
Beds:YearBuilt_1900           3.556e-03  2.890e-03   1.230    0.222    
Size_sqft:DaysListed          1.390e-07  3.598e-07   0.386    0.700    
Size_sqft:YearBuilt_1900      3.126e-07  2.926e-06   0.107    0.915    
DaysListed:YearBuilt_1900     2.876e-06  2.527e-05   0.114    0.910    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.1253 on 91 degrees of freedom
Multiple R-squared:  0.5245,    Adjusted R-squared:  0.4513 
F-statistic: 7.168 on 14 and 91 DF,  p-value: 9.238e-10</code></pre>
</div>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">try</span>(<span class="fu">Anova</span>(lm_full, <span class="at">type=</span><span class="dv">3</span>))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Error in Anova.III.lm(mod, error, singular.ok = singular.ok, ...) : 
  there are aliased coefficients in the model</code></pre>
</div>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Note that this doesn't work because APARTMENTs only have 1 bed and 1 bath.</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>  <span class="do">## There isn't a second level of bed or bath to estimate the interaction.</span></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Therefore, remove those two terms</span></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>  lm_full <span class="ot">&lt;-</span></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">update</span>(</span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>      lm_full</span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>    , . <span class="sc">~</span> . <span class="sc">-</span> TypeSale<span class="sc">:</span>Beds</span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">try</span>(<span class="fu">Anova</span>(lm_full, <span class="at">type=</span><span class="dv">3</span>))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Anova Table (Type III tests)

Response: log10(PriceListK)
                           Sum Sq Df F value    Pr(&gt;F)    
(Intercept)               0.66456  1 42.2963 4.151e-09 ***
TypeSale                  0.01112  1  0.7078    0.4024    
Beds                      0.01571  1  0.9997    0.3200    
Size_sqft                 0.00907  1  0.5775    0.4492    
DaysListed                0.00062  1  0.0396    0.8428    
YearBuilt_1900            0.02842  1  1.8085    0.1820    
TypeSale:Size_sqft        0.00003  1  0.0016    0.9679    
TypeSale:DaysListed       0.01672  1  1.0640    0.3050    
TypeSale:YearBuilt_1900   0.00660  1  0.4200    0.5186    
Beds:Size_sqft            0.00101  1  0.0644    0.8003    
Beds:DaysListed           0.01768  1  1.1255    0.2915    
Beds:YearBuilt_1900       0.02379  1  1.5141    0.2217    
Size_sqft:DaysListed      0.00234  1  0.1492    0.7002    
Size_sqft:YearBuilt_1900  0.00018  1  0.0114    0.9152    
DaysListed:YearBuilt_1900 0.00020  1  0.0130    0.9096    
Residuals                 1.42980 91                      
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Uncomment this line when you're ready to assess the model assumptions</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="co"># plot diagnostics</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a><span class="fu">e_plot_lm_diagostics</span>(lm_full)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="ADA2_CL_14_ANCOVA_AbqHomePrices_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" width="960"></p>
</div>
<div class="cell-output-display">
<p><img src="ADA2_CL_14_ANCOVA_AbqHomePrices_files/figure-html/unnamed-chunk-14-2.png" class="img-fluid" width="960"></p>
</div>
<div class="cell-output-display">
<p><img src="ADA2_CL_14_ANCOVA_AbqHomePrices_files/figure-html/unnamed-chunk-14-3.png" class="img-fluid" width="960"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Non-constant Variance Score Test 
Variance formula: ~ fitted.values 
Chisquare = 0.6971503, Df = 1, p = 0.40374</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>there are higher-order terms (interactions) in this model
consider setting type = 'predictor'; see ?vif</code></pre>
</div>
<div class="cell-output-display">
<p><img src="ADA2_CL_14_ANCOVA_AbqHomePrices_files/figure-html/unnamed-chunk-14-4.png" class="img-fluid" width="960"></p>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in e_plot_lm_diagostics(lm_full): Note: Collinearity plot unreliable
for predictors that also have interactions in the model.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="ADA2_CL_14_ANCOVA_AbqHomePrices_files/figure-html/unnamed-chunk-14-5.png" class="img-fluid" width="960"></p>
</div>
<div class="cell-output-display">
<p><img src="ADA2_CL_14_ANCOVA_AbqHomePrices_files/figure-html/unnamed-chunk-14-6.png" class="img-fluid" width="960"></p>
</div>
<div class="cell-output-display">
<p><img src="ADA2_CL_14_ANCOVA_AbqHomePrices_files/figure-html/unnamed-chunk-14-7.png" class="img-fluid" width="960"></p>
</div>
<div class="cell-output-display">
<p><img src="ADA2_CL_14_ANCOVA_AbqHomePrices_files/figure-html/unnamed-chunk-14-8.png" class="img-fluid" width="960"></p>
</div>
<div class="cell-output-display">
<p><img src="ADA2_CL_14_ANCOVA_AbqHomePrices_files/figure-html/unnamed-chunk-14-9.png" class="img-fluid" width="960"></p>
</div>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co"># List the row numbers with id numbers</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="co">#   The row numbers appear in the residual plots.</span></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   The id number can be used to exclude values in code above.</span></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>dat_sub <span class="sc">%&gt;%</span> <span class="fu">select</span>(id) <span class="sc">%&gt;%</span> <span class="fu">print</span>(<span class="at">n =</span> <span class="cn">Inf</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 106 × 1
       id
    &lt;int&gt;
  1     6
  2     7
  3     9
  4    10
  5    12
  6    13
  7    14
  8    15
  9    16
 10    17
 11    20
 12    21
 13    22
 14    23
 15    24
 16    25
 17    26
 18    27
 19    28
 20    29
 21    30
 22    31
 23    33
 24    34
 25    35
 26    36
 27    38
 28    39
 29    40
 30    41
 31    42
 32    43
 33    44
 34    45
 35    46
 36    47
 37    48
 38    49
 39    51
 40    52
 41    53
 42    54
 43    55
 44    56
 45    57
 46    58
 47    60
 48    61
 49    62
 50    64
 51    65
 52    67
 53    68
 54    69
 55    70
 56    71
 57    72
 58    73
 59    74
 60    75
 61    76
 62    77
 63    78
 64    79
 65    81
 66    83
 67    84
 68    85
 69    86
 70    87
 71    88
 72    89
 73    91
 74    92
 75    94
 76    97
 77    98
 78    99
 79   100
 80   101
 81   102
 82   103
 83   104
 84   105
 85   106
 86   108
 87   109
 88   110
 89   111
 90   112
 91   113
 92   114
 93   115
 94   116
 95   118
 96   119
 97   121
 98   123
 99   124
100   126
101   127
102   128
103   131
104   133
105   134
106   135</code></pre>
</div>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">shapiro.test</span>(lm_full<span class="sc">$</span>residuals)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Shapiro-Wilk normality test

data:  lm_full$residuals
W = 0.98268, p-value = 0.183</code></pre>
</div>
</div>
<p>After Step 2, interpret the residual plots. What are the primary issues in the original model?</p>
<section id="solution-2" class="level3">
<h3 class="anchored" data-anchor-id="solution-2">Solution</h3>
<p>[answer] The Residual plot is roughly normal however the tail and head is skewed. by Shapiro test the residual p-value is greater than .05 which means we have not enough evidence that say residuals is not normal. so we met normality assumption. the residuals vs fitted value look acceptable. the plots for residuals vs other features are also acceptable</p>
<p>because there was high correlation between bath and beds and also lotsize we remove baths and lotsize from our model and also APARTMENTs don’t have more than 1 Beds or Baths,so those interaction terms need to be excluded from the model. so we fixed the collinearity problem in the model.</p>
</section>
</section>
<section id="p-step-5-model-selection-check-model-assumptions." class="level2">
<h2 class="anchored" data-anchor-id="p-step-5-model-selection-check-model-assumptions."><strong>(2 p)</strong> (Step 5) Model selection, check model assumptions.</h2>
<p>Using <code>step(..., direction="both")</code> with the BIC criterion, perform model selection.</p>
<section id="solution-3" class="level3">
<h3 class="anchored" data-anchor-id="solution-3">Solution</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="do">## BIC</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a><span class="co"># option: test="F" includes additional information</span></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a><span class="co">#           for parameter estimate tests that we're familiar with</span></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a><span class="co"># option: for BIC, include k=log(nrow( [data.frame name] ))</span></span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>lm_red_BIC <span class="ot">&lt;-</span></span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step</span>(</span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>    lm_full</span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a>  , <span class="at">direction =</span> <span class="st">"both"</span></span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a>  , <span class="at">test =</span> <span class="st">"F"</span></span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a>  , <span class="at">trace =</span> <span class="dv">0</span></span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a>  , <span class="at">k =</span> <span class="fu">log</span>(<span class="fu">nrow</span>(dat_sub))</span>
<span id="cb75-12"><a href="#cb75-12" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb75-13"><a href="#cb75-13" aria-hidden="true" tabindex="-1"></a>lm_final <span class="ot">&lt;-</span> lm_red_BIC</span>
<span id="cb75-14"><a href="#cb75-14" aria-hidden="true" tabindex="-1"></a>lm.final <span class="ot">=</span> lm_red_BIC</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Uncomment this line when you're ready to assess the model assumptions</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="co"># plot diagnostics</span></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a><span class="fu">e_plot_lm_diagostics</span>(lm_final)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="ADA2_CL_14_ANCOVA_AbqHomePrices_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="960"></p>
</div>
<div class="cell-output-display">
<p><img src="ADA2_CL_14_ANCOVA_AbqHomePrices_files/figure-html/unnamed-chunk-16-2.png" class="img-fluid" width="960"></p>
</div>
<div class="cell-output-display">
<p><img src="ADA2_CL_14_ANCOVA_AbqHomePrices_files/figure-html/unnamed-chunk-16-3.png" class="img-fluid" width="960"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Non-constant Variance Score Test 
Variance formula: ~ fitted.values 
Chisquare = 1.789649, Df = 1, p = 0.18097</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in e_plot_lm_diagostics(lm_final): Note: Collinearity plot unreliable
for predictors that also have interactions in the model.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="ADA2_CL_14_ANCOVA_AbqHomePrices_files/figure-html/unnamed-chunk-16-4.png" class="img-fluid" width="960"></p>
</div>
<div class="cell-output-display">
<p><img src="ADA2_CL_14_ANCOVA_AbqHomePrices_files/figure-html/unnamed-chunk-16-5.png" class="img-fluid" width="960"></p>
</div>
</div>
<p>Model assumptions appear to be reasonably met. A few influential observations exist. The residuals are roughly distributed normal based on QQplot (there is a little bit skewness, but it is not that much severe). A few influential observations exist. The variances looks constant. based on box-cox plot we do not need transformation. residuals look acceptable</p>
</section>
</section>
<section id="p-step-6-plot-final-model-interpret-coefficients." class="level2">
<h2 class="anchored" data-anchor-id="p-step-6-plot-final-model-interpret-coefficients."><strong>(4 p)</strong> (Step 6) Plot final model, interpret coefficients.</h2>
<p>If you arrived at the same model I did, then the code below will plot it. Eventually (after Step 7), the fitted model equations will describe the each dwelling <code>TypeSale</code> and interpret the coefficients.</p>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<p><img src="ADA2_CL_14_ANCOVA_AbqHomePrices_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid" width="768"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a><span class="fu">Anova</span>(lm.final, <span class="at">type=</span><span class="dv">3</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Anova Table (Type III tests)

Response: log10(PriceListK)
               Sum Sq  Df F value    Pr(&gt;F)    
(Intercept)    9.4443   1 633.368 &lt; 2.2e-16 ***
TypeSale       0.6950   1  46.611 6.363e-10 ***
Size_sqft      1.3438   1  90.118 1.079e-15 ***
YearBuilt_1900 0.2879   1  19.309 2.729e-05 ***
Residuals      1.5210 102                      
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lm.final)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = log10(PriceListK) ~ TypeSale + Size_sqft + YearBuilt_1900, 
    data = dat_sub)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.41779 -0.06529  0.00684  0.05714  0.34219 

Coefficients:
                 Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)     2.004e+00  7.964e-02  25.167  &lt; 2e-16 ***
TypeSaleHOUSE   2.233e-01  3.271e-02   6.827 6.36e-10 ***
Size_sqft       2.064e-04  2.174e-05   9.493 1.08e-15 ***
YearBuilt_1900 -5.718e-03  1.301e-03  -4.394 2.73e-05 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.1221 on 102 degrees of freedom
Multiple R-squared:  0.4941,    Adjusted R-squared:  0.4793 
F-statistic: 33.21 on 3 and 102 DF,  p-value: 4.639e-15</code></pre>
</div>
</div>
<p>Fitted model equation is <span class="math display">\[
  \widehat{\log{10}(\textrm{PriceList})}
    =
    2
  + 0.223 I({TypeSale} = \textrm{HOUSE})
  + 2.06\times 10^{-4} (\textrm{Size.sqft})
  + -0.00572 (\textrm{YearBuilt})
\]</span></p>
<section id="solution-4" class="level3">
<h3 class="anchored" data-anchor-id="solution-4">Solution</h3>
<p>After Step 7, return and interpret the model coefficients above.</p>
<p>[answer] the log10 of Price will increase if<br>
on average, by one sqft increase in size we expect 2.06^{-4} increase in log(PriceListK) assuming other variables constant.<br>
on average, by one year increase in yearBuild we expect -0.00572 increase in log(PriceListK) assuming other variables constant.<br>
for Apartment, on average the log(PriceListK) would be 2 if all other variable would be zero(which is not usefull for interpretation).<br>
for House, on average the log(PriceListK) would be (2 + 0.223) if all other variable would be zero(which is not usefull for interpretation).</p>
</section>
</section>
<section id="p-step-7-transform-predictors." class="level2">
<h2 class="anchored" data-anchor-id="p-step-7-transform-predictors."><strong>(2 p)</strong> (Step 7) Transform predictors.</h2>
<p>We now have enough information to see that a transformation of a predictor can be useful. See the curvature with <code>Size_sqft</code>? This is one of the headaches of regression modelling, <em>everything depends on everything else</em> and you learn as you go. Return to the top and transform <code>Size_sqft</code> and <code>LotSize</code>.</p>
<p>A nice feature of this transformation is that the model interaction goes away. Our interpretation is now on the log scale, but it’s a simpler model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>  <span class="do">## SOLUTION</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>  lm_full_logSize <span class="ot">&lt;-</span></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lm</span>(</span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">log10</span>(PriceListK) <span class="sc">~</span> (TypeSale <span class="sc">+</span> Beds <span class="sc">+</span> <span class="fu">log10</span>(Size_sqft) <span class="sc">+</span> DaysListed <span class="sc">+</span> YearBuilt_1900)<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>    , <span class="at">data =</span> dat_sub</span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">#lm_full &lt;-</span></span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">#  lm(</span></span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">#    PriceListK ~ (Beds + Baths + Size_sqft + LotSize + DaysListed + YearBuilt_1900)^2</span></span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">#  , data = dat_sub</span></span>
<span id="cb84-11"><a href="#cb84-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">#  )</span></span>
<span id="cb84-12"><a href="#cb84-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>(lm_full_logSize)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = log10(PriceListK) ~ (TypeSale + Beds + log10(Size_sqft) + 
    DaysListed + YearBuilt_1900)^2, data = dat_sub)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.37568 -0.06478  0.01052  0.06831  0.27809 

Coefficients: (1 not defined because of singularities)
                                  Estimate Std. Error t value Pr(&gt;|t|)
(Intercept)                      1.086e+00  2.381e+00   0.456    0.649
TypeSaleHOUSE                    1.177e+00  1.421e+00   0.829    0.409
Beds                            -5.668e-01  5.710e-01  -0.993    0.323
log10(Size_sqft)                 4.733e-01  7.519e-01   0.629    0.531
DaysListed                      -1.487e-03  4.480e-03  -0.332    0.741
YearBuilt_1900                  -2.247e-02  4.348e-02  -0.517    0.607
TypeSaleHOUSE:Beds                      NA         NA      NA       NA
TypeSaleHOUSE:log10(Size_sqft)  -2.403e-01  4.396e-01  -0.546    0.586
TypeSaleHOUSE:DaysListed         9.654e-04  9.530e-04   1.013    0.314
TypeSaleHOUSE:YearBuilt_1900    -4.997e-03  8.291e-03  -0.603    0.548
Beds:log10(Size_sqft)            1.268e-01  1.759e-01   0.721    0.473
Beds:DaysListed                 -4.139e-04  4.056e-04  -1.020    0.310
Beds:YearBuilt_1900              3.439e-03  2.997e-03   1.147    0.254
log10(Size_sqft):DaysListed      2.995e-04  1.356e-03   0.221    0.826
log10(Size_sqft):YearBuilt_1900  3.890e-03  1.325e-02   0.294    0.770
DaysListed:YearBuilt_1900        1.184e-05  2.455e-05   0.482    0.631

Residual standard error: 0.1221 on 91 degrees of freedom
Multiple R-squared:  0.5485,    Adjusted R-squared:  0.479 
F-statistic: 7.895 on 14 and 91 DF,  p-value: 1.132e-10</code></pre>
</div>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">try</span>(<span class="fu">Anova</span>(lm_full_logSize, <span class="at">type=</span><span class="dv">3</span>))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Error in Anova.III.lm(mod, error, singular.ok = singular.ok, ...) : 
  there are aliased coefficients in the model</code></pre>
</div>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Note that this doesn't work because APARTMENTs only have 1 bed and 1 bath.</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>  <span class="do">## There isn't a second level of bed or bath to estimate the interaction.</span></span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Therefore, remove those two terms</span></span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>  lm_full_logSize <span class="ot">&lt;-</span></span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">update</span>(</span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>      lm_full_logSize</span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a>    , . <span class="sc">~</span> . <span class="sc">-</span> TypeSale<span class="sc">:</span>Beds</span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">try</span>(<span class="fu">Anova</span>(lm_full_logSize, <span class="at">type=</span><span class="dv">3</span>))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Anova Table (Type III tests)

Response: log10(PriceListK)
                                 Sum Sq Df F value Pr(&gt;F)
(Intercept)                     0.00310  1  0.2080 0.6494
TypeSale                        0.01024  1  0.6866 0.4095
Beds                            0.01470  1  0.9856 0.3235
log10(Size_sqft)                0.00591  1  0.3962 0.5306
DaysListed                      0.00164  1  0.1102 0.7407
YearBuilt_1900                  0.00398  1  0.2671 0.6065
TypeSale:log10(Size_sqft)       0.00446  1  0.2986 0.5861
TypeSale:DaysListed             0.01531  1  1.0263 0.3137
TypeSale:YearBuilt_1900         0.00542  1  0.3633 0.5482
Beds:log10(Size_sqft)           0.00775  1  0.5196 0.4729
Beds:DaysListed                 0.01554  1  1.0414 0.3102
Beds:YearBuilt_1900             0.01964  1  1.3167 0.2542
log10(Size_sqft):DaysListed     0.00073  1  0.0488 0.8257
log10(Size_sqft):YearBuilt_1900 0.00129  1  0.0862 0.7698
DaysListed:YearBuilt_1900       0.00347  1  0.2324 0.6309
Residuals                       1.35764 91               </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Uncomment this line when you're ready to assess the model assumptions</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a><span class="co"># plot diagnostics</span></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a><span class="fu">e_plot_lm_diagostics</span>(lm_full_logSize)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="ADA2_CL_14_ANCOVA_AbqHomePrices_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid" width="960"></p>
</div>
<div class="cell-output-display">
<p><img src="ADA2_CL_14_ANCOVA_AbqHomePrices_files/figure-html/unnamed-chunk-20-2.png" class="img-fluid" width="960"></p>
</div>
<div class="cell-output-display">
<p><img src="ADA2_CL_14_ANCOVA_AbqHomePrices_files/figure-html/unnamed-chunk-20-3.png" class="img-fluid" width="960"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Non-constant Variance Score Test 
Variance formula: ~ fitted.values 
Chisquare = 1.591387, Df = 1, p = 0.20713</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>there are higher-order terms (interactions) in this model
consider setting type = 'predictor'; see ?vif</code></pre>
</div>
<div class="cell-output-display">
<p><img src="ADA2_CL_14_ANCOVA_AbqHomePrices_files/figure-html/unnamed-chunk-20-4.png" class="img-fluid" width="960"></p>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in e_plot_lm_diagostics(lm_full_logSize): Note: Collinearity plot
unreliable for predictors that also have interactions in the model.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="ADA2_CL_14_ANCOVA_AbqHomePrices_files/figure-html/unnamed-chunk-20-5.png" class="img-fluid" width="960"></p>
</div>
<div class="cell-output-display">
<p><img src="ADA2_CL_14_ANCOVA_AbqHomePrices_files/figure-html/unnamed-chunk-20-6.png" class="img-fluid" width="960"></p>
</div>
<div class="cell-output-display">
<p><img src="ADA2_CL_14_ANCOVA_AbqHomePrices_files/figure-html/unnamed-chunk-20-7.png" class="img-fluid" width="960"></p>
</div>
<div class="cell-output-display">
<p><img src="ADA2_CL_14_ANCOVA_AbqHomePrices_files/figure-html/unnamed-chunk-20-8.png" class="img-fluid" width="960"></p>
</div>
<div class="cell-output-display">
<p><img src="ADA2_CL_14_ANCOVA_AbqHomePrices_files/figure-html/unnamed-chunk-20-9.png" class="img-fluid" width="960"></p>
</div>
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="co"># List the row numbers with id numbers</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a><span class="co">#   The row numbers appear in the residual plots.</span></span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   The id number can be used to exclude values in code above.</span></span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a><span class="fu">shapiro.test</span>(lm_full_logSize<span class="sc">$</span>residuals)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Shapiro-Wilk normality test

data:  lm_full_logSize$residuals
W = 0.98387, p-value = 0.2277</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>lm_red_BIC_logSize <span class="ot">&lt;-</span></span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step</span>(</span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>    lm_full_logSize</span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>  , <span class="at">direction =</span> <span class="st">"both"</span></span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a>  , <span class="at">test =</span> <span class="st">"F"</span></span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a>  , <span class="at">trace =</span> <span class="dv">0</span></span>
<span id="cb96-7"><a href="#cb96-7" aria-hidden="true" tabindex="-1"></a>  , <span class="at">k =</span> <span class="fu">log</span>(<span class="fu">nrow</span>(dat_sub))</span>
<span id="cb96-8"><a href="#cb96-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb96-9"><a href="#cb96-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-10"><a href="#cb96-10" aria-hidden="true" tabindex="-1"></a>lm.final.logSize <span class="ot">=</span> lm_red_BIC_logSize</span>
<span id="cb96-11"><a href="#cb96-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-12"><a href="#cb96-12" aria-hidden="true" tabindex="-1"></a><span class="fu">e_plot_lm_diagostics</span>(lm.final.logSize)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="ADA2_CL_14_ANCOVA_AbqHomePrices_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid" width="576"></p>
</div>
<div class="cell-output-display">
<p><img src="ADA2_CL_14_ANCOVA_AbqHomePrices_files/figure-html/unnamed-chunk-21-2.png" class="img-fluid" width="576"></p>
</div>
<div class="cell-output-display">
<p><img src="ADA2_CL_14_ANCOVA_AbqHomePrices_files/figure-html/unnamed-chunk-21-3.png" class="img-fluid" width="576"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Non-constant Variance Score Test 
Variance formula: ~ fitted.values 
Chisquare = 4.091626, Df = 1, p = 0.043096</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in e_plot_lm_diagostics(lm.final.logSize): Note: Collinearity plot
unreliable for predictors that also have interactions in the model.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="ADA2_CL_14_ANCOVA_AbqHomePrices_files/figure-html/unnamed-chunk-21-4.png" class="img-fluid" width="576"></p>
</div>
<div class="cell-output-display">
<p><img src="ADA2_CL_14_ANCOVA_AbqHomePrices_files/figure-html/unnamed-chunk-21-5.png" class="img-fluid" width="576"></p>
</div>
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lm.final.logSize)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = log10(PriceListK) ~ TypeSale + log10(Size_sqft) + 
    YearBuilt_1900, data = dat_sub)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.42236 -0.07062  0.00990  0.07286  0.31216 

Coefficients:
                  Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)      -0.360661   0.271947  -1.326 0.187729    
TypeSaleHOUSE     0.210319   0.031363   6.706 1.13e-09 ***
log10(Size_sqft)  0.833836   0.084437   9.875  &lt; 2e-16 ***
YearBuilt_1900   -0.004655   0.001236  -3.768 0.000276 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.1198 on 102 degrees of freedom
Multiple R-squared:  0.5129,    Adjusted R-squared:  0.4986 
F-statistic:  35.8 on 3 and 102 DF,  p-value: 6.868e-16</code></pre>
</div>
</div>
<p><span class="math display">\[
  \widehat{\log{10}(\textrm{PriceList})}
    =
    -0.361
  + 0.21 I({TypeSale} = \textrm{HOUSE})
  + 0.834 (\textrm{log10(Size.sqft)})
  + -0.00466 (\textrm{YearBuilt})
\]</span></p>
<p>on average, by one unit log(size_sqft) increase we expect 0.834 increase in log(PriceListK) assuming other variables constant.<br>
on average, by one year decrease in yearBuild we expect -0.00466 increase in log(PriceListK) assuming other variables constant.<br>
for Apartment, on average the log(PriceListK) would be –0.361 if all other variable would be zero(which is not usefull for interpretation).<br>
for House, on average the log(PriceListK) would be (-0.361+0.21) if all other variable would be zero(which is not usefull for interpretation).</p>
</section>
<section id="p-step-8-predict-new-observations-interpret-models-predictive-ability." class="level2">
<h2 class="anchored" data-anchor-id="p-step-8-predict-new-observations-interpret-models-predictive-ability."><strong>(4 p)</strong> (Step 8) Predict new observations, interpret model’s predictive ability.</h2>
<p>Using the <code>predict()</code> function, we’ll input the data we held out to predict earlier, and use our final model to predict the <code>PriceListK</code> response. Note that <code>10^lm_pred</code> is the table of values on the scale of “thousands of dollars”.</p>
<p>Interpret the predictions below the output.</p>
<p>How well do you expect this model to predict? Justify your answer.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="co"># predict new observations, convert to data frame</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>lm_pred <span class="ot">&lt;-</span></span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>(</span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">predict</span>(</span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a>      lm_final</span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a>    , <span class="at">newdata =</span> dat_pred</span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a>    , <span class="at">interval =</span> <span class="st">"prediction"</span></span>
<span id="cb101-8"><a href="#cb101-8" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb101-9"><a href="#cb101-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb101-10"><a href="#cb101-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb101-11"><a href="#cb101-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># add column of actual list prices</span></span>
<span id="cb101-12"><a href="#cb101-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">PriceListK =</span> dat_pred<span class="sc">$</span>PriceListK_true</span>
<span id="cb101-13"><a href="#cb101-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb101-14"><a href="#cb101-14" aria-hidden="true" tabindex="-1"></a>lm_pred</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       fit      lwr      upr PriceListK
1 2.188175 1.944126 2.432224      186.9
2 2.250483 2.001429 2.499536      305.0
3 2.076528 1.820203 2.332853      244.0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="co"># on "thousands of dollars" scale</span></span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a><span class="dv">10</span><span class="sc">^</span>lm_pred</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       fit       lwr      upr    PriceListK
1 154.2321  87.92769 270.5354 7.943282e+186
2 178.0256 100.32957 315.8902 1.000000e+305
3 119.2691  66.10022 215.2053 1.000000e+244</code></pre>
</div>
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="co"># attributes of the three predicted observations</span></span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>dat_pred <span class="sc">%&gt;%</span> <span class="fu">print</span>(<span class="at">n =</span> <span class="cn">Inf</span>, <span class="at">width =</span> <span class="cn">Inf</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 8
     id TypeSale   Beds Size_sqft DaysListed YearBuilt_1900 PriceListK
  &lt;int&gt; &lt;fct&gt;     &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;          &lt;dbl&gt; &lt;lgl&gt;     
1     1 HOUSE         3      1305          0             54 NA        
2     2 APARTMENT     1      2523          0             48 NA        
3     3 APARTMENT     1      2816          0             89 NA        
  PriceListK_true
            &lt;dbl&gt;
1            187.
2            305 
3            244 </code></pre>
</div>
</div>
<section id="solution-5" class="level3">
<h3 class="anchored" data-anchor-id="solution-5">Solution</h3>
<p>[answer]</p>
</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>